<%= render :partial => "tokbox_code" %>
<div id="menubar" class="topbar notes">
  <div class="middle">
    <h3>StudyHall - <%= @study_session.created_at.strftime("%d/%m/%y") %></h3>
  </div>
  <div class="right">
    <%= link_to "Invite Others to Study", new_study_session_invite_path(@study_session), id: "invite_button", class: "btn", remote: true %>
  </div>
  <div class="left">
    <%= link_to("X", study_sessions_path, :class => "btn") %>
  </div>
</div>
<div class="clearfix"></div>
<div id="video_sidebar">
  <div id="opentok_console"></div>
  <div id="links">
    <a class="btn" value="Connect" id ="connectLink" onClick="javascript:connect()">Connect</a>
    <a class="btn" value="Leave" id ="disconnectLink" onClick="javascript:disconnect()" >Leave</a>
    <a class="btn" value="Start Publishing" id ="publishLink" onClick="javascript:startPublishing()">Start Sharing</a>
    <a class="btn" value="Stop Publishing" id ="unpublishLink" onClick="javascript:stopPublishing()">Stop Sharing</a>
  </div>
  <div id="myCamera" class="publisherContainer"></div>
  <div id="subscribers"></div>
</div>

<% if @study_session.session_files.any? %>
  <iframe id="whiteboard" src="http://crocodoc.com/<%= @study_session.session_files.first.short_id rescue "" %>?embedded=true" frameborder="1" width="700" height="650"></iframe>
<% else %>
  <% @study_session.session_files.build %>
  <div id="upload_form">
    <%= form_for @study_session, :html => {:class => "form-stacked"} do |f| %>
      <%= f.fields_for :session_files do |sf| %>
        <%= f.label :upload, "Upload a File" %>
        <%= sf.file_field :upload %>
        <%= f.submit "Upload", :class => "btn primary" %>
      <% end %>
    <% end %>
  </div>
<% end %>
<div class="clearfix"></div>

<script>
  $(document).ready(function(){
    show('connectLink');
    hide("disconnectLink");
    hide("publishLink");
    hide("unpublishLink");
    var wb = $("#whiteboard");
    wb.attr("src", wb.data("url"));
  });
</script>
