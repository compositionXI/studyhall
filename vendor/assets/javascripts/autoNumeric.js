/**
* autoNumeric.js
* @author: Bob Knothe
* @author: Sokolov Yura aka funny_falcon
* @version: 1.7.4-B
*
* Created by Robert J. Knothe on 2010-10-25. Please report any bug at http://www.decorplanit.com/plugin/
* Created by Sokolov Yura on 2010-11-07. http://github.com/funny_falcon
*
* Copyright (c) 2011 Robert J. Knothe  http://www.decorplanit.com/plugin/
* Copyright (c) 2011 Sokolov Yura aka funny_falcon
*
* The MIT License (http://www.opensource.org/licenses/mit-license.php)
*
* Permission is hereby granted, free of charge, to any person
* obtaining a copy of this software and associated documentation
* files (the "Software"), to deal in the Software without
* restriction, including without limitation the rights to use,
* copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the
* Software is furnished to do so, subject to the following
* conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
* OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
* HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
* WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
* OTHER DEALINGS IN THE SOFTWARE.
*/

(function(f){function w(a,b){f.each(b,function(c,d){if("function"===typeof d)b[c]=d(a,b,c);else if("string"===typeof d){var e=d.substr(0,4);"fun:"===e?(e=f.autoNumeric[d.substr(4)],b[c]="function"===typeof e?f.autoNumeric[d.substr(4)](a,b,c):null):"css:"===e&&(b[c]=f(d.substr(4)).val())}})}function m(a,b){"string"===typeof a[b]&&(a[b]*=1)}function k(a,b){var c=f.extend({},f.fn.autoNumeric.defaults,b);f.metadata&&(c=f.extend(c,a.metadata()));w(a,c);var d=c.vMax.toString().split("."),e=!c.vMin&&0!==
c.vMin?[]:c.vMin.toString().split(".");m(c,"vMax");m(c,"vMin");m(c,"mDec");c.aNeg=0>c.vMin?"-":"";if("number"!==typeof c.mDec)c.mDec=Math.max((d[1]?d[1]:"").length,(e[1]?e[1]:"").length);if(null===c.altDec&&0<c.mDec)if("."===c.aDec&&","!==c.aSep)c.altDec=",";else if(","===c.aDec&&"."!==c.aSep)c.altDec=".";d=c.aNeg?"([-\\"+c.aNeg+"]?)":"(-?)";c._aNegReg=d;c._skipFirst=RegExp(d+"[^-"+(c.aNeg?"\\"+c.aNeg:"")+"\\"+c.aDec+"\\d].*?(\\d|\\"+c.aDec+"\\d)");c._skipLast=RegExp("(\\d\\"+c.aDec+"?)[^\\"+c.aDec+
"\\d]\\D*$");e=(c.aNeg?c.aNeg:"-")+c.aNum+"\\"+c.aDec;c.altDec&&c.altDec!==c.aSep&&(e+=c.altDec);c._allowed=RegExp("[^"+e+"]","gi");c._numReg=RegExp(d+"(?:\\"+c.aDec+"?(\\d+\\"+c.aDec+"\\d+)|(\\d*(?:\\"+c.aDec+"\\d*)?))");return c}function g(a,b,c){var d;if(b.aSign)for(;-1<a.indexOf(b.aSign);)a=a.replace(b.aSign,"");a=a.replace(b._skipFirst,"$1$2");a=a.replace(b._skipLast,"$1");a=a.replace(b._allowed,"");b.altDec&&(a=a.replace(b.altDec,b.aDec));d=(a=a.match(b._numReg))?[a[1],a[2],a[3]].join(""):"",
a=d;c&&(b="^"+b._aNegReg+"0*(\\d"+("leading"===c?")":"|$)"),a=a.replace(RegExp(b),"$1$2"));return a}function s(a,b,c){if(b&&c){var d=a.split(b);d[1]&&d[1].length>c&&(0<c?(d[1]=d[1].substring(0,c),a=d.join(b)):a=d[0])}return a}function n(a,b,c){b&&"."!==b&&(a=a.replace(b,"."));c&&"-"!==c&&(a=a.replace(c,"-"));a.match(/\d/)||(a+="0");return a}function t(a,b,c){c&&"-"!==c&&(a=a.replace("-",c));b&&"."!==b&&(a=a.replace(".",b));return a}function o(a,b){var a=g(a,b),a=s(a,b.aDec,b.mDec),a=n(a,b.aDec,b.aNeg),
c=+a;return c>=b.vMin&&c<=b.vMax}function l(a,b,c){return""===a||a===b.aNeg?"zero"===b.wEmpty?a+"0":"sign"===b.wEmpty||c?a+b.aSign:a:null}function p(a,b){var a=g(a,b),c=l(a,b,!0);if(null!==c)return c;var c="",c=2===b.dGroup?/(\d)((\d)(\d{2}?)+)$/:4===b.dGroup?/(\d)((\d{4}?)+)$/:/(\d)((\d{3}?)+)$/,d=a.split(b.aDec);b.altDec&&1===d.length&&(d=a.split(b.altDec));var e=d[0];if(b.aSep)for(;c.test(e);)e=e.replace(c,"$1"+b.aSep+"$2");0!==b.mDec&&1<d.length?(d[1].length>b.mDec&&(d[1]=d[1].substring(0,b.mDec)),
a=e+b.aDec+d[1]):a=e;b.aSign&&(c=-1!==a.indexOf(b.aNeg),a=a.replace(b.aNeg,""),a="p"===b.pSign?b.aSign+a:a+b.aSign,c&&(a=b.aNeg+a));return a}function q(a,b,c,d){var a=""===a?"0":a.toString(),e="",e=0,f="",g="boolean"===typeof d||null===d?d?b:0:+d,d=function(a){a=a.replace(0===g?/(\.[1-9]*)0*$/:1===g?/(\.\d[1-9]*)0*$/:RegExp("(\\.\\d{"+g+"}[1-9]*)0*$"),"$1");0===g&&(a=a.replace(/\.$/,""));return a};"-"===a.charAt(0)&&(f="-",a=a.replace("-",""));a.match(/^\d/)||(a="0"+a);"-"===f&&0===+a&&(f="");0<+a&&
(a=a.replace(/^0*(\d)/,"$1"));var i=a.lastIndexOf("."),h=a.length-1-(-1===i?a.length-1:i);if(h<=b){e=a;if(h<g)for(-1===i&&(e+=".");h<g;)c="000000".substring(0,g-h),e+=c,h+=c.length;else h>g?e=d(e):0===h&&0===g&&(e=e.replace(/\.$/,""));return f+e}b=i+b;e=+a.charAt(b+1);h=a.substring(0,b+1).split("");a="."===a.charAt(b)?a.charAt(b-1)%2:a.charAt(b)%2;if(4<e&&"S"===c||4<e&&"A"===c&&""===f||5<e&&"A"===c&&"-"===f||5<e&&"s"===c||5<e&&"a"===c&&""===f||4<e&&"a"===c&&"-"===f||5<e&&"B"===c||5===e&&"B"===c&&
1===a||0<e&&"C"===c&&""===f||0<e&&"F"===c&&"-"===f||0<e&&"U"===c)for(e=h.length-1;0<=e;e-=1)if("."!==h[e])if(h[e]=+h[e]+1,10>h[e])break;else 0<e&&(h[e]="0");h=h.slice(0,b+1);e=d(h.join(""));return f+e}function u(a,b){this.options=b;this.that=a;this.$that=f(a);this.formatted=!1;this.io=k(this.$that,this.options);this.value=a.value}function i(a,b){var c;c=a.data("autoNumeric");c||(c={},a.data("autoNumeric",c));var d=c.holder;if(void 0===d&&b)d=new u(a.get(0),b),c.holder=d;return d}function v(a){return(a=
a.data("autoNumeric"))&&a.holder?a.holder.options:{}}function x(a){var b=f(a.target),b=i(b);b.init(a);if(b.skipAllways(a))return b.processed=!0;if(b.processAllways())return b.processed=!0,b.formatQuick(),a.preventDefault(),!1;b.formatted=!1;return!0}function y(a){var b=f(a.target),b=i(b),c=b.processed;b.init(a);if(b.skipAllways(a))return!0;if(c)return a.preventDefault(),!1;if(b.processAllways()||b.processKeypress())return b.formatQuick(),a.preventDefault(),!1;b.formatted=!1}function z(a){var b=f(a.target),
b=i(b);b.init(a);a=b.skipAllways(a);b.kdCode=0;delete b.valuePartsBeforePaste;if(a)return!0;if(""===this.value)return!0;b.formatted||b.formatQuick()}function A(a){var a=f(a.target),b=i(a);b.inVal=a.val();b=l(b.inVal,b.io,!0);null!==b&&a.val(b)}function B(a){var a=f(a.target),b=i(a),c=b.io,d=a.val(),e=d;""!==d&&(d=g(d,c),null===l(d,c)&&o(d,c)?(d=n(d,c.aDec,c.aNeg),d=q(d,c.mDec,c.mRound,c.aPad),d=t(d,c.aDec,c.aNeg)):d="");var j=l(d,c,!1);null===j&&(j=p(d,c));j!==e&&a.val(j);j!==b.inVal&&(a.change(),
delete b.inVal)}function r(a){"string"===typeof a&&(a=a.replace(/\[/g,"\\[").replace(/\]/g,"\\]"),a="#"+a.replace(/(:|\.)/g,"\\$1"));return f(a)}u.prototype={init:function(a){this.value=this.that.value;this.io=k(this.$that,this.options);this.cmdKey=a.metaKey;this.shiftKey=a.shiftKey;var b=this.that,c={};if(void 0===b.selectionStart){b.focus();var d=document.selection.createRange();c.length=d.text.length;d.moveStart("character",-b.value.length);c.end=d.text.length;c.start=c.end-c.length}else c.start=
b.selectionStart,c.end=b.selectionEnd,c.length=c.end-c.start;this.selection=c;if("keydown"===a.type||"keyup"===a.type)this.kdCode=a.keyCode;this.which=a.which;this.formatted=this.processed=!1},setSelection:function(a,b,c){a=Math.max(a,0);b=Math.min(b,this.that.value.length);this.selection={start:a,end:b,length:b-a};if(void 0===c||c)c=this.that,void 0===c.selectionStart?(c.focus(),c=c.createTextRange(),c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",a),c.select()):(c.selectionStart=
a,c.selectionEnd=b)},setPosition:function(a,b){this.setSelection(a,a,b)},getBeforeAfter:function(){var a=this.value,b=a.substring(0,this.selection.start),a=a.substring(this.selection.end,a.length);return[b,a]},getBeforeAfterStriped:function(){var a=this.getBeforeAfter();a[0]=g(a[0],this.io);a[1]=g(a[1],this.io);return a},normalizeParts:function(a,b){var c=this.io,b=g(b,c),d=b.match(/^\d/)?!0:"leading",a=g(a,c,d);if(""===a||a===c.aNeg)""<b&&(b=b.replace(/^0*(\d)/,"$1"));d=a+b;if(c.aDec){var e=d.match(RegExp("^"+
c._aNegReg+"\\"+c.aDec));e&&(a=a.replace(e[1],e[1]+"0"),d=a+b)}if("zero"===c.wEmpty&&(d===c.aNeg||""===d))a+="0";return[a,b]},setValueParts:function(a,b){var c=this.io,d=this.normalizeParts(a,b),e=d.join(""),d=d[0].length;if(o(e,c)){e=s(e,c.aDec,c.mDec);if(d>e.length)d=e.length;this.value=e;this.setPosition(d,!1);return!0}return!1},signPosition:function(){var a=this.io,b=a.aSign,c=this.that;if(b){b=b.length;if("p"===a.pSign)return a.aNeg&&c.value&&c.value.charAt(0)===a.aNeg?[1,b+1]:[0,b];a=c.value.length;
return[a-b,a]}return[1E3,-1]},expandSelectionOnSign:function(a){var b=this.signPosition(),c=this.selection;c.start<b[1]&&c.end>b[0]&&((c.start<b[0]||c.end>b[1])&&this.value.substring(Math.max(c.start,b[0]),Math.min(c.end,b[1])).match(/^\s*$/)?c.start<b[0]?this.setSelection(c.start,b[0],a):this.setSelection(b[1],c.end,a):this.setSelection(Math.min(c.start,b[0]),Math.max(c.end,b[1]),a))},checkPaste:function(){if(void 0!==this.valuePartsBeforePaste){var a=this.getBeforeAfter(),b=this.valuePartsBeforePaste;
delete this.valuePartsBeforePaste;a[0]=a[0].substr(0,b[0].length)+g(a[0].substr(b[0].length),this.io);if(!this.setValueParts(a[0],a[1]))this.value=b.join(""),this.setPosition(b[0].length,!1)}},skipAllways:function(a){var b=this.kdCode,c=this.which,d=this.cmdKey;if(17===b&&"keyup"===a.type&&void 0!==this.valuePartsBeforePaste)return this.checkPaste(),!1;if(112<=b&&123>=b||91<=b&&93>=b||9<=b&&31>=b||8>b&&(0===c||c===b)||144===b||145===b||45===b)return!0;if(d&&65===b)return!0;if(d&&(67===b||86===b||
88===b)){"keydown"===a.type&&this.expandSelectionOnSign();if(86===b)if("keydown"===a.type||"keypress"===a.type){if(void 0===this.valuePartsBeforePaste)this.valuePartsBeforePaste=this.getBeforeAfter()}else this.checkPaste();return"keydown"===a.type||"keypress"===a.type||67===b}if(d)return!0;if(37===b||39===b){var c=this.io.aSep,d=this.selection.start,e=this.that.value;"keydown"===a.type&&c&&!this.shiftKey&&(37===b&&e.charAt(d-2)===c?this.setPosition(d-1):39===b&&e.charAt(d)===c&&this.setPosition(d+
1));return!0}return 34<=b&&40>=b?!0:!1},processAllways:function(){var a;return 8===this.kdCode||46===this.kdCode?(this.selection.length?(this.expandSelectionOnSign(!1),a=this.getBeforeAfterStriped()):(a=this.getBeforeAfterStriped(),8===this.kdCode?a[0]=a[0].substring(0,a[0].length-1):a[1]=a[1].substring(1,a[1].length)),this.setValueParts(a[0],a[1]),!0):!1},processKeypress:function(){var a=this.io,b=String.fromCharCode(this.which),c=this.getBeforeAfterStriped(),d=c[0],c=c[1];if(b===a.aDec||a.altDec&&
b===a.altDec||("."===b||","===b)&&110===this.kdCode){if(!a.mDec||!a.aDec)return!0;if(a.aNeg&&-1<c.indexOf(a.aNeg))return!0;if(-1<d.indexOf(a.aDec))return!0;if(0<c.indexOf(a.aDec))return!0;0===c.indexOf(a.aDec)&&(c=c.substr(1));this.setValueParts(d+a.aDec,c);return!0}if("-"===b||"+"===b){if(!a.aNeg)return!0;if(""===d&&-1<c.indexOf(a.aNeg))d=a.aNeg,c=c.substring(1,c.length);d=d.charAt(0)===a.aNeg?d.substring(1,d.length):"-"===b?a.aNeg+d:d;this.setValueParts(d,c);return!0}if("0"<=b&&"9">=b){if(a.aNeg&&
""===d&&-1<c.indexOf(a.aNeg))d=a.aNeg,c=c.substring(1,c.length);this.setValueParts(d+b,c)}return!0},formatQuick:function(){var a=this.io,b=this.getBeforeAfterStriped(),c=p(this.value,this.io),d=c.length;if(c){var b=b[0].split(""),e;for(e=0;e<b.length;e+=1)b[e].match("\\d")||(b[e]="\\"+b[e]);b=RegExp("^.*?"+b.join(".*?"));if(b=c.match(b)){if(d=b[0].length,(0===d&&c.charAt(0)!==a.aNeg||1===d&&c.charAt(0)===a.aNeg)&&a.aSign&&"p"===a.pSign)d=this.io.aSign.length+("-"===c.charAt(0)?1:0)}else a.aSign&&
"s"===a.pSign&&(d-=a.aSign.length)}this.that.value=c;this.setPosition(d);this.formatted=!0}};f.fn.autoNumeric=function(a){return this.each(function(){var b=a,b=b||{},c=f(this),d=i(c,b);d.io.aForm&&(this.value||"empty"!==d.io.wEmpty)&&c.autoNumericSet(c.autoNumericGet(b),b)}).unbind(".autoNumeric").bind({"keydown.autoNumeric":x,"keypress.autoNumeric":y,"keyup.autoNumeric":z,"focusin.autoNumeric":A,"focusout.autoNumeric":B})};f.autoNumeric={};f.autoNumeric.Strip=function(a,b){var c=r(a),d=v(c);b&&"object"===
typeof b&&(d=f.extend({},d,b));c=k(c,d);d=r(a).val();d=g(d,c);d=n(d,c.aDec,c.aNeg);0===+d&&(d="0");return d};f.autoNumeric.Format=function(a,b,c){var a=r(a),d=v(a);c&&"object"===typeof c&&(d=f.extend({},d,c));c=k(a,d);b=q(b,c.mDec,c.mRound,c.aPad);b=t(b,c.aDec,c.aNeg);o(b,c)||(b=q("",c.mDec,c.mRound,c.aPad));return p(b,c)};f.fn.autoNumericGet=function(a){return a?f.autoNumeric.Strip(this,a):f.autoNumeric.Strip(this)};f.fn.autoNumericSet=function(a,b){return b?this.val(f.autoNumeric.Format(this,a,
b)):this.val(f.fn.autoNumeric.Format(this,a))};f.autoNumeric.defaults={aNum:"0123456789",aSep:",",dGroup:"3",aDec:".",altDec:null,aSign:"",pSign:"p",vMax:"999999999.99",vMin:"0.00",mDec:null,mRound:"S",aPad:!0,wEmpty:"empty",aForm:!1};f.fn.autoNumeric.defaults=f.autoNumeric.defaults;f.fn.autoNumeric.Strip=f.autoNumeric.Strip;f.fn.autoNumeric.Format=f.autoNumeric.Format})(jQuery);